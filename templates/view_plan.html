<script>
                const editButton = document.getElementById('editButton');
                const planForm = document.getElementById('planForm');
                let isEditing = false;
                const inputElements = planForm.querySelectorAll('input, textarea');

                editButton.addEventListener('click', async () => {
                    isEditing = !isEditing;
                    if (isEditing) {
                        // Enter edit mode
                        editButton.innerHTML = 'ðŸ’¾ Save Plan';
                        editButton.classList.remove('bg-sky-600', 'hover:bg-sky-700');
                        editButton.classList.add('bg-green-600', 'hover:bg-green-700');
                        inputElements.forEach(element => element.disabled = false);
                    } else {
                        // Save changes
                        const planId = document.getElementById('planId').value;
                        const formData = new FormData(planForm);
                        const planData = Object.fromEntries(formData.entries());

                        try {
                            const response = await fetch(`/plans/${planId}/update`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(planData)
                            });

                            if (!response.ok) {
                                throw new Error('Failed to update plan');
                            }

                            const result = await response.json();

                            // Update UI
                            editButton.innerHTML = 'âœï¸ Edit Plan';
                            editButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                            editButton.classList.add('bg-sky-600', 'hover:bg-sky-700');
                            inputElements.forEach(element => element.disabled = true);

                            // Show success message
                            alert('Plan updated successfully!');

                            // Update page title
                            document.getElementById('planTitle').textContent = planData.full_name;
                        } catch (error) {
                            console.error('Error updating plan:', error);
                            alert('Error updating plan: ' + error.message);
                            isEditing = true; // Stay in edit mode
                        }
                    }
                });
            </script>